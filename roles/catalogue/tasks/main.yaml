    - name: App setup for {{ component }}
      ansible.builtin.include_role:
        name: common
        tasks_from: app_setup.yaml
        apply:
         tags:
        - deployment

    - name:  nodejs setup for {{ component }}
      ansible.builtin.import_role:
        name: common
        tasks_from: nodejs_setup.yaml

    - name:  systemd setup for {{ component }}
      ansible.builtin.import_role:
        name: common
        tasks_from: systemd_setup.yaml

    - name: copying mongodb repo
      ansible.builtin.copy:
        src: mongo.repo
        dest: /etc/yum.repos.d/mongo.repo
           
    - name: Installing mongodb client 
      ansible.builtin.dnf:
        name: mongodb-mongosh
        state: present

    - name: check products loaded
      ansible.builtin.command: mongosh --host "{{ MONGODB_HOST }}" --quiet  --eval 'db.getMongo().getDBNames().indexOf("catalogue")'
      register: catalogue_output

    - name: load the products
      ansible.builtin.shell: mongosh --host "{{ MONGODB_HOST }}" </app/db/master-data.js
      when: catalogue_output.stdout  | int < 0

    - name: start {{ component }}
      ansible.builtin.service:
        name: "{{ component }}"
        state: restarted
        enabled: yes